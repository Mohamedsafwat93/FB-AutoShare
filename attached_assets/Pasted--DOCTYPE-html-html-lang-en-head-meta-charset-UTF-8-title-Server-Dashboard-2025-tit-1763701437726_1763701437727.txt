<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Server Dashboard 2025</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        margin: 0;
        padding: 0;
        background: #0d0d0d;
        color: #fff;
        font-family: 'Segoe UI', sans-serif;
    }

    h1 {
        text-align: center;
        margin: 30px 0 10px 0;
        font-size: 35px;
        font-weight: 600;
        letter-spacing: 2px;
        color: #00d0ff;
    }

    #container {
        width: 94%;
        margin: auto;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 25px;
        margin-top: 35px;
    }

    .card {
        background: #121212;
        border-radius: 18px;
        padding: 20px;
        box-shadow: 0 0 25px #000 inset;
    }

    .card h2 {
        text-align: center;
        font-size: 22px;
        margin-bottom: 10px;
        color: #00ffd5;
    }

    canvas {
        height: 220px !important;
    }

    #services {
        grid-column: span 3;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    th, td {
        padding: 12px;
        text-align: center;
        background: #1b1b1b;
        border-bottom: 1px solid #333;
        font-size: 15px;
    }

    th {
        background: #00aaff;
    }

    button {
        width: 200px;
        height: 45px;
        background: #ff004c;
        border: none;
        color: white;
        border-radius: 10px;
        font-size: 17px;
        cursor: pointer;
        transition: 0.3s;
        margin-top: 20px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    button:hover {
        background: #ff336d;
    }

    footer {
        text-align: center;
        color: #888;
        margin: 40px 0 20px 0;
        font-size: 16px;
    }
</style>
</head>
<body>

<h1>ðŸš€ Facebook Automation Dashboard â€” 2025</h1>

<div id="container">

    <!-- CPU -->
    <div class="card">
        <h2>CPU Usage</h2>
        <canvas id="cpuChart"></canvas>
    </div>

    <!-- RAM -->
    <div class="card">
        <h2>RAM Usage</h2>
        <canvas id="ramChart"></canvas>
    </div>

    <!-- DISK -->
    <div class="card">
        <h2>Disk Usage</h2>
        <canvas id="diskChart"></canvas>
    </div>

    <!-- NETWORK -->
    <div class="card">
        <h2>Network (Realâ€‘Time)</h2>
        <canvas id="netChart"></canvas>
    </div>

    <!-- EMPTY TO ALIGN GRID -->
    <div class="card"></div>

    <!-- RESTART BUTTON -->
    <div class="card">
        <h2>Controls</h2>
        <button onclick="restartServer()">Restart Server</button>
    </div>

    <!-- SERVICES TABLE -->
    <div class="card" id="services">
        <h2>Active Services</h2>
        <table id="servicesTable">
            <tr>
                <th>Service</th>
                <th>Port</th>
                <th>Status</th>
            </tr>
        </table>
    </div>

</div>

<footer>
    Made With Love &lt;3 By Eng Muhammed Safwat
</footer>

<script>
function gradient(ctx, c1, c2) {
    let g = ctx.createLinearGradient(0, 0, 0, 250);
    g.addColorStop(0, c1);
    g.addColorStop(1, c2);
    return g;
}

let cpuChart, ramChart, diskChart, netChart;

async function loadStats() {
    const res = await fetch("/api/stats");
    const data = await res.json();

    let cpu = data.cpuUsage;
    let ram = ((data.totalMem - data.freeMem) / data.totalMem * 100).toFixed(1);
    let disk = (data.diskUsed / data.diskTotal * 100).toFixed(1);

    // Network: use random data until backend adds it
    let net = Math.floor(Math.random() * 100);

    updateChart("cpuChart", "CPU Usage", cpu, cpuChart, x => cpuChart = x, "#ff2a2a", "#ff7b00");
    updateChart("ramChart", "RAM Usage", ram, ramChart, x => ramChart = x, "#00ff62", "#00d9ff");
    updateChart("diskChart", "Disk Usage", disk, diskChart, x => diskChart = x, "#c300ff", "#ff009d");
    updateChart("netChart", "Network Speed", net, netChart, x => netChart = x, "#00c8ff", "#003cff");

    updateServices(data.services || []);
}

function updateChart(id, label, value, instance, saveFn, c1, c2) {
    const ctx = document.getElementById(id).getContext("2d");

    if (!instance) {
        saveFn(new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: ["Used", "Free"],
                datasets: [{
                    data: [value, 100 - value],
                    backgroundColor: [gradient(ctx, c1, c2), "#2a2a2a"],
                    borderWidth: 0
                }]
            },
            options: {
                cutout: "70%",
                plugins: {
                    tooltip: { enabled: true },
                    title: {
                        display: true,
                        text: label,
                        color: "#fff",
                        font: { size: 18 }
                    }
                }
            }
        }));
    } else {
        instance.data.datasets[0].data = [value, 100 - value];
        instance.update();
    }
}

function updateServices(list) {
    let table = document.getElementById("servicesTable");

    table.innerHTML = `
        <tr>
            <th>Service</th>
            <th>Port</th>
            <th>Status</th>
        </tr>
    `;

    list.forEach(s => {
        table.innerHTML += `
        <tr>
            <td>${s.name}</td>
            <td>${s.port}</td>
            <td style="color: ${s.status === "online" ? "#00ff88" : "#ff4d4d"};">
                ${s.status}
            </td>
        </tr>
        `;
    });
}

function restartServer() {
    fetch("/api/restart", { method: "POST" });
    alert("Restart command sent.");
}

setInterval(loadStats, 1500);
loadStats();
</script>

</body>
</html>
