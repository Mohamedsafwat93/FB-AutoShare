<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Server Dashboard 2025</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body { font-family: 'Segoe UI', sans-serif; background: #0d0d0d; color: #fff; }
    h1 { text-align: center; margin: 30px 0 10px 0; font-size: 35px; font-weight: 600; letter-spacing: 2px; color: #00d0ff; }
    .stats { width: 94%; margin: 25px auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
    .stat-card { background: #1a1a1a; border-left: 4px solid #00d0ff; padding: 15px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
    .stat-card h3 { margin: 0 0 10px 0; color: #00ffd5; font-size: 16px; }
    .stat-card p { margin: 8px 0; font-size: 12px; color: #aaa; line-height: 1.5; }
    #container { width: 94%; margin: auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 35px; }
    .card { background: #121212; border-radius: 18px; padding: 20px; box-shadow: 0 0 25px #000 inset; }
    .card h2 { text-align: center; font-size: 22px; margin-bottom: 10px; color: #00ffd5; }
    canvas { height: 220px !important; }
    #services { grid-column: span -1; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 12px; text-align: center; background: #1b1b1b; border-bottom: 1px solid #333; font-size: 14px; }
    th { background: #00aaff; color: #000; font-weight: 600; }
    button { width: 200px; height: 45px; background: #ff004c; border: none; color: white; border-radius: 10px; font-size: 17px; cursor: pointer; transition: 0.3s; margin-top: 20px; display: block; margin-left: auto; margin-right: auto; }
    button:hover { background: #ff336d; transform: scale(1.05); }
    .social-container { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin: 30px 0; }
    .social-btn { padding: 12px 25px; border-radius: 25px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); border: none; cursor: pointer; font-size: 14px; }
    .github-btn { background: linear-gradient(135deg, #333, #555); color: #fff; }
    .github-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(100, 100, 100, 0.6); }
    .facebook-btn { background: linear-gradient(135deg, #1877f2, #0a66c2); color: #fff; }
    .facebook-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(24, 119, 242, 0.6); }
    .youtube-btn { background: linear-gradient(135deg, #ff0000, #cc0000); color: #fff; }
    .youtube-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(255, 0, 0, 0.6); }
    .tiktok-btn { background: linear-gradient(135deg, #000000, #25f4ee); color: #fff; }
    .tiktok-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.8); }
    .instagram-btn { background: linear-gradient(135deg, #fd1d1d, #833ab4); color: #fff; }
    .instagram-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(253, 29, 29, 0.6); }
    footer { text-align: center; margin: 40px 0 20px 0; }
    .dropdown-toggle { background: #1877f2; color: #fff; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 13px; font-weight: 600; }
    .dropdown-toggle:hover { background: #0d5cb8; }
    .dropdown-content { display: none; position: relative; margin-top: 10px; }
    .dropdown-content.active { display: block; }
    .group-item { background: #1a1a1a; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #1877f2; font-size: 12px; }
    .facebook-section { background: #121212; padding: 15px; border-radius: 8px; margin: 20px 0; }
    .facebook-section h3 { color: #00ffd5; margin-top: 0; }
    @media (max-width: 768px) { #container { grid-template-columns: 1fr; } #services { grid-column: span 1; } .stats { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<h1>üöÄ Facebook Automation Dashboard ‚Äî 2025</h1>

<!-- Quick Stats Section -->
<div class="stats">
  <div class="stat-card">
    <h3>üíæ RAM</h3>
    <p id="ram-info">Loading...</p>
  </div>
  <div class="stat-card">
    <h3>‚ö° CPU</h3>
    <p id="cpu-info">Loading...</p>
  </div>
  <div class="stat-card">
    <h3>üíø Hard Disk</h3>
    <p id="disk-info">Loading...</p>
  </div>
  <div class="stat-card">
    <h3>üåê Network</h3>
    <p id="network-info">Loading...</p>
  </div>
</div>

<div id="container">

    <!-- CPU -->
    <div class="card">
        <h2>CPU Usage</h2>
        <canvas id="cpuChart"></canvas>
    </div>

    <!-- RAM -->
    <div class="card">
        <h2>RAM Usage</h2>
        <canvas id="ramChart"></canvas>
    </div>

    <!-- DISK -->
    <div class="card">
        <h2>Disk Usage</h2>
        <canvas id="diskChart"></canvas>
    </div>

    <!-- NETWORK -->
    <div class="card">
        <h2>Network (Real‚ÄëTime)</h2>
        <canvas id="netChart"></canvas>
    </div>

    <!-- DISK CLEANUP BUTTON -->
    <div class="card">
        <h2>Disk Cleanup</h2>
        <button onclick="cleanupDisk()" style="background: #00ff62; color: #000;">Clean Disk Cache</button>
    </div>

    <!-- RESTART BUTTON -->
    <div class="card">
        <h2>Controls</h2>
        <button onclick="restartServer()">Restart Server</button>
    </div>

    <!-- SERVICES TABLE -->
    <div class="card" id="services">
        <h2>Active Services</h2>
        <table id="servicesTable">
            <tr>
                <th>Proto</th>
                <th>Local Address</th>
                <th>State</th>
                <th>PID/Program</th>
            </tr>
        </table>
    </div>

    <!-- FACEBOOK MANAGEMENT SECTION -->
    <div style="width: 94%; margin: 30px auto;">
        <div class="facebook-section">
            <h3>üì± Facebook Posting & Groups Management</h3>
            
            <!-- Token Status -->
            <div style="margin-bottom: 15px; padding: 10px; background: #1a1a1a; border-radius: 5px;">
                <button onclick="validateTokens()" style="background: #1877f2; color: #fff; width: 100%; padding: 8px; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">üîç Check Facebook Tokens</button>
                <p id="token-status" style="font-size: 11px; color: #888; margin: 8px 0;"></p>
            </div>

            <!-- Post to Page -->
            <div style="margin-bottom: 15px;">
                <h4 style="color: #00ffd5; margin: 10px 0;">Post to Your Page</h4>
                <input type="text" id="fb-message" placeholder="Enter your message..." style="width: 100%; padding: 8px; margin: 8px 0; border-radius: 5px; border: 1px solid #333; background: #1a1a1a; color: #fff; box-sizing: border-box;">
                <input type="text" id="fb-link" placeholder="Optional link..." style="width: 100%; padding: 8px; margin: 8px 0; border-radius: 5px; border: 1px solid #333; background: #1a1a1a; color: #fff; box-sizing: border-box;">
                <button onclick="postToFacebook()" style="background: #1877f2; color: #fff; width: 100%; padding: 8px; border: none; border-radius: 5px; cursor: pointer; margin: 8px 0;">Post to Facebook</button>
                <p id="fb-status" style="font-size: 11px; color: #888; margin: 5px 0;"></p>
            </div>

            <!-- Groups Section -->
            <div>
                <button class="dropdown-toggle" onclick="toggleGroupsDropdown()">üë• Facebook Groups Status</button>
                <div id="groups-dropdown" class="dropdown-content">
                    <textarea id="group-ids" placeholder="Enter Group IDs (comma-separated or one per line)&#10;Example: 123456789, 987654321" style="width: 100%; height: 60px; padding: 8px; margin: 8px 0; border-radius: 5px; border: 1px solid #333; background: #1a1a1a; color: #fff; font-family: monospace; font-size: 11px; box-sizing: border-box;"></textarea>
                    <button onclick="verifyGroups()" style="background: #1877f2; color: #fff; width: 100%; padding: 8px; border: none; border-radius: 5px; cursor: pointer;">Verify Groups</button>
                    <div id="groups-container" style="margin-top: 10px; max-height: 250px; overflow-y: auto;">
                        <p style="color: #888; text-align: center; font-size: 12px;">Paste group IDs and click Verify</p>
                    </div>
                    <p id="group-status" style="font-size: 11px; color: #888; margin-top: 8px;"></p>
                </div>
            </div>
        </div>
    </div>

</div>

<footer>
    <h3 style="color: #00ffd5; margin-bottom: 15px;">Connect With Me</h3>
    <div class="social-container">
        <a href="https://kutt.it/SolutionsFB" target="_blank" class="social-btn facebook-btn">
            üëç Facebook
        </a>
        <a href="https://kutt.it/SolutionsYT" target="_blank" class="social-btn youtube-btn">
            ‚ñ∂Ô∏è YouTube
        </a>
        <a href="https://kutt.it/SolutionsTT" target="_blank" class="social-btn tiktok-btn">
            üéµ TikTok
        </a>
        <a href="https://kutt.it/SolutionsIG" target="_blank" class="social-btn instagram-btn">
            üì∏ Instagram
        </a>
        <a href="https://github.com/Mohamedsafwat93" target="_blank" class="social-btn github-btn">
            üöÄ GitHub
        </a>
    </div>
    <p style="color: #888; font-size: 14px; margin-top: 20px;">Made With Love ‚ù§Ô∏è By Eng. Muhammed Safwat</p>
</footer>

<script>
function gradient(ctx, c1, c2) {
    let g = ctx.createLinearGradient(0, 0, 0, 250);
    g.addColorStop(0, c1);
    g.addColorStop(1, c2);
    return g;
}

let cpuChart, ramChart, diskChart, netChart;

async function loadStats() {
    try {
        const res = await fetch("/api/stats?t=" + Date.now());
        const data = await res.json();

        let cpu = data.cpu?.usage || 0;
        let ram = ((data.ram.used / data.ram.total) * 100).toFixed(1);
        let disk = data.disk && data.disk[0] ? ((data.disk[0].used / data.disk[0].size) * 100).toFixed(1) : 0;
        let net = Math.floor(Math.random() * 100);

        updateChart("cpuChart", "CPU Usage", cpu, cpuChart, x => cpuChart = x, "#ff2a2a", "#ff7b00");
        updateChart("ramChart", "RAM Usage", ram, ramChart, x => ramChart = x, "#00ff62", "#00d9ff");
        updateChart("diskChart", "Disk Usage", disk, diskChart, x => diskChart = x, "#c300ff", "#ff009d");
        updateChart("netChart", "Network Speed", net, netChart, x => netChart = x, "#00c8ff", "#003cff");

        updateServices(data.services || []);
    } catch(e) {
        console.error("Error loading stats:", e);
    }
}

function updateChart(id, label, value, instance, saveFn, c1, c2) {
    const ctx = document.getElementById(id).getContext("2d");

    if (!instance) {
        saveFn(new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: ["Used", "Free"],
                datasets: [{
                    data: [value, 100 - value],
                    backgroundColor: [gradient(ctx, c1, c2), "#2a2a2a"],
                    borderWidth: 0
                }]
            },
            options: {
                cutout: "70%",
                plugins: {
                    tooltip: { enabled: true },
                    title: {
                        display: true,
                        text: label,
                        color: "#fff",
                        font: { size: 18 }
                    }
                }
            }
        }));
    } else {
        instance.data.datasets[0].data = [value, 100 - value];
        instance.update();
    }
}

function updateServices(list) {
    let table = document.getElementById("servicesTable");

    table.innerHTML = `
        <tr>
            <th>Proto</th>
            <th>Local Address</th>
            <th>State</th>
            <th>PID/Program</th>
        </tr>
    `;

    if (list && list.length > 0) {
        list.forEach(s => {
            table.innerHTML += `
            <tr>
                <td>${s.proto || 'N/A'}</td>
                <td>${s.localAddress || 'N/A'}</td>
                <td>${s.state || 'N/A'}</td>
                <td>${s.pid_program || 'N/A'}</td>
            </tr>
            `;
        });
    } else {
        table.innerHTML += '<tr><td colspan="4">No services data available</td></tr>';
    }
}

function restartServer() {
    const password = prompt("üîí Enter password to restart server:");
    
    if(password === null) {
        return; // User cancelled
    }
    
    if(password === "") {
        alert("‚ùå Password cannot be empty");
        return;
    }
    
    fetch("/api/restart", { 
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: password })
    })
    .then(res => res.json())
    .then(data => {
        if(data.error) {
            alert("‚ùå " + data.error);
        } else {
            alert("‚úÖ " + data.message);
        }
    })
    .catch(err => alert("‚ùå Error: " + err.message));
}

function cleanupDisk() {
    const password = prompt("üîí Enter password to cleanup disk cache:");
    
    if(password === null) {
        return; // User cancelled
    }
    
    if(password === "") {
        alert("‚ùå Password cannot be empty");
        return;
    }
    
    fetch("/api/cleanup", { 
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: password })
    })
    .then(res => res.json())
    .then(data => {
        if(data.error) {
            alert("‚ùå " + data.error);
        } else {
            let message = "‚úÖ " + data.message + "\n\n";
            if(data.results) {
                message += data.results.join("\n");
            }
            alert(message);
        }
    })
    .catch(err => alert("‚ùå Error: " + err.message));
}

async function postToFacebook() {
    const message = document.getElementById('fb-message').value.trim();
    const link = document.getElementById('fb-link').value.trim();
    const statusEl = document.getElementById('fb-status');
    
    if(!message) {
        statusEl.innerText = '‚ùå Message cannot be empty';
        return;
    }
    
    statusEl.innerText = '‚è≥ Publishing...';
    
    try {
        const response = await fetch("/api/facebook/post", {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                message: message,
                link: link || null 
            })
        });
        
        const data = await response.json();
        
        if(data.success) {
            statusEl.innerText = '‚úÖ ' + data.message;
            document.getElementById('fb-message').value = '';
            document.getElementById('fb-link').value = '';
            setTimeout(() => { statusEl.innerText = ''; }, 5000);
        } else {
            statusEl.innerText = '‚ùå ' + (data.error || 'Failed to post');
        }
    } catch(err) {
        statusEl.innerText = '‚ùå Error: ' + err.message;
    }
}

async function verifyGroups() {
    const groupIdsText = document.getElementById('group-ids').value.trim();
    const container = document.getElementById('groups-container');
    const statusEl = document.getElementById('group-status');
    
    if(!groupIdsText) {
        statusEl.innerText = '‚ùå Please enter at least one group ID';
        return;
    }

    // Parse group IDs (comma or newline separated)
    const groupIds = groupIdsText.split(/[,\n]/).map(id => id.trim()).filter(id => id);
    
    if(groupIds.length === 0) {
        statusEl.innerText = '‚ùå No valid group IDs found';
        return;
    }

    statusEl.innerText = '‚è≥ Verifying ' + groupIds.length + ' group(s)...';
    container.innerHTML = '';
    
    try {
        const response = await fetch("/api/facebook/groups-verify", {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ group_ids: groupIds })
        });
        
        const data = await response.json();
        
        if(data.groups && data.groups.length > 0) {
            let html = `<p style="color: #00ffd5; margin-bottom: 15px;">‚úÖ Verified ${data.valid_groups} of ${data.total_requested} groups:</p>`;
            
            data.groups.forEach(group => {
                html += `
                <div style="background: #1a1a1a; padding: 12px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #00ff62;">
                    <strong style="color: #00ffd5;">${group.name}</strong><br>
                    <small style="color: #888;">ID: ${group.id} | Members: ${group.member_count || 'N/A'}</small><br>
                    <button onclick="postToGroup('${group.id}', '${group.name}');" style="background: #1877f2; color: #fff; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 12px; margin-top: 8px;">üì§ Post to this group</button>
                </div>
                `;
            });
            
            if(data.invalid && data.invalid.length > 0) {
                html += `<p style="color: #ff6b6b; margin-top: 15px;">‚ö†Ô∏è ${data.invalid.length} group(s) could not be verified - check IDs</p>`;
            }
            
            container.innerHTML = html;
            statusEl.innerText = '‚úÖ Groups verified successfully!';
        } else {
            statusEl.innerText = '‚ùå No valid groups found. Check your group IDs.';
            container.innerHTML = '<p style="color: #ff6b6b;">No groups to display</p>';
        }
    } catch(err) {
        statusEl.innerText = '‚ùå Error: ' + err.message;
        container.innerHTML = '';
    }
}

function toggleGroupsDropdown() {
    const dropdown = document.getElementById('groups-dropdown');
    dropdown.classList.toggle('active');
}

async function validateTokens() {
    const statusEl = document.getElementById('token-status');
    statusEl.innerText = '‚è≥ Checking tokens...';
    
    try {
        const response = await fetch('/api/facebook/validate-token');
        const data = await response.json();
        
        let statusText = '';
        
        if(data.page_token?.valid) {
            statusText += '‚úÖ Page Token: Valid (' + data.page_token.name + ')\n';
        } else {
            statusText += '‚ùå Page Token: ' + (data.page_token?.error || 'Invalid');
            if(data.auto_page_token?.available) {
                statusText += ' (Using auto-generated page token)\n';
            } else {
                statusText += '\n';
            }
        }
        
        if(data.user_token?.valid) {
            statusText += '‚úÖ User Token: Valid (' + data.user_token.name + ')\n';
        } else {
            statusText += '‚ùå User Token: ' + (data.user_token?.error || 'Invalid') + '\n';
        }
        
        if(data.auto_page_token?.available) {
            statusText += '‚ú® Auto-Generated: Page found "' + data.auto_page_token.page_name + '" - Posting enabled!';
        }
        
        statusEl.innerHTML = statusText.replace(/\n/g, '<br>');
    } catch(err) {
        statusEl.innerText = '‚ùå Error: ' + err.message;
    }
}

function postToGroup(groupId, groupName) {
    const message = prompt(`üí¨ Enter message for "${groupName}":`);
    if(!message) return;
    
    fetch("/api/facebook/group-post", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            group_id: groupId,
            message: message
        })
    })
    .then(res => res.json())
    .then(data => {
        if(data.success) {
            alert('‚úÖ Posted to ' + groupName);
        } else {
            alert('‚ùå Error: ' + (data.error || 'Failed to post'));
        }
    })
    .catch(err => alert('‚ùå Error: ' + err.message));
}

setInterval(loadStats, 1500);
loadStats();

// Quick Stats Update
async function updateQuickStats() {
  try {
    const res = await fetch("/api/server-stats?t=" + Date.now());
    const data = await res.json();

    const ramUsed = (data.ram.used / 1024 / 1024).toFixed(2);
    const ramTotal = (data.ram.total / 1024 / 1024).toFixed(2);
    const ramFree = (ramTotal - ramUsed).toFixed(2);
    document.getElementById('ram-info').innerText = `Used: ${ramUsed} MB\nFree: ${ramFree} MB\nTotal: ${ramTotal} MB`;

    document.getElementById('cpu-info').innerText = `Usage: ${data.cpu.percent}%\nCores: ${data.cpu.cores}`;

    const diskUsed = (data.disk.used / 1024 / 1024 / 1024).toFixed(2);
    const diskTotal = (data.disk.total / 1024 / 1024 / 1024).toFixed(2);
    const diskFree = (diskTotal - diskUsed).toFixed(2);
    document.getElementById('disk-info').innerText = `Used: ${diskUsed} GB\nFree: ${diskFree} GB\nTotal: ${diskTotal} GB`;
  } catch(e) {
    console.error('Quick stats error:', e);
  }
}

// Network Stats Update
async function updateNetworkStats() {
  try {
    const res = await fetch("/api/stats?t=" + Date.now());
    const data = await res.json();
    
    const net = data.network || { rx_sec: 0, tx_sec: 0 };
    const download = (net.rx_sec / 1024 / 1024).toFixed(2); // Convert to MB/s
    const upload = (net.tx_sec / 1024 / 1024).toFixed(2);   // Convert to MB/s
    const speed = (Math.max(parseFloat(download), parseFloat(upload))).toFixed(2);
    
    document.getElementById('network-info').innerText = `Download: ${download} MB/s\nUpload: ${upload} MB/s\nSpeed: ${speed} MB/s`;
  } catch(e) {
    console.error('Network stats error:', e);
  }
}

setInterval(updateQuickStats, 1000);
updateQuickStats();

setInterval(updateNetworkStats, 1000);
updateNetworkStats();
</script>

</body>
</html>
