<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>Facebook Automation Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; background:#1e1e1e; color:#fff; padding:20px;}
h1 { color:#4caf50; }
.card { background:#2c2c2c; padding:20px; margin:15px 0; border-radius:8px; }
button { margin:10px 5px; padding:10px 15px; cursor:pointer; border:none; border-radius:5px; background:#4caf50; color:#fff; }
button:hover { background:#45a049; }
canvas { background:#1e1e1e; border-radius:8px; margin:15px 0; }
footer { text-align:center; margin-top:20px; color:#888; font-size:14px; }
.stats { display:flex; flex-wrap:wrap; gap:15px; }
.stat-item { flex:1 1 200px; background:#333; padding:10px; border-radius:5px; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { padding:8px; border:1px solid #555; text-align:left; }
th { background:#444; }
</style>
</head>
<body>

<h1>ðŸš€ Facebook Automation Dashboard</h1>

<div class="card stats">
  <div class="stat-item"><strong>Uptime:</strong> <span id="uptime">0</span> sec</div>
  <div class="stat-item"><strong>Platform:</strong> <span id="platform"></span></div>
  <div class="stat-item"><strong>OS Release:</strong> <span id="osRelease"></span></div>
  <div class="stat-item"><strong>Node.js:</strong> <span id="node"></span></div>
  <div class="stat-item"><strong>CPU:</strong> <span id="cpu"></span></div>
  <div class="stat-item"><strong>CPU Usage:</strong> <span id="cpuUsage">0</span>%</div>
</div>

<div class="card">
  <canvas id="ramChart" width="400" height="100"></canvas>
  <canvas id="diskChart" width="400" height="100"></canvas>
  <canvas id="networkChart" width="400" height="100"></canvas>
</div>

<div class="card">
  <h3>Active Services</h3>
  <table>
    <thead>
      <tr><th>Proto</th><th>Local Address</th><th>State</th><th>PID/Program</th></tr>
    </thead>
    <tbody id="servicesTable"></tbody>
  </table>
</div>

<div class="card">
  <h3>Controls</h3>
  <button onclick="restartServer()">Restart Server</button>
  <button onclick="openLogin()">Open Login Page</button>
</div>

<footer>Made With Love &lt;3 By Eng Muhammed Safwat</footer>

<script>
let ramChart,diskChart,networkChart;

async function fetchStats(){
  try{
    const res = await fetch('/api/stats?t='+Date.now());
    if(!res.ok) throw new Error('API error: '+res.status);
    const data = await res.json();
    document.getElementById('uptime').textContent = data.uptime.toFixed(2);
    document.getElementById('platform').textContent = data.platform;
    document.getElementById('osRelease').textContent = data.osRelease;
    document.getElementById('node').textContent = data.node;
    document.getElementById('cpu').textContent = `${data.cpuCores} cores - ${data.cpuModel}`;
    document.getElementById('cpuUsage').textContent = data.cpuUsage;

    const ramUsage = ((data.totalMem - data.freeMem)/data.totalMem*100).toFixed(1);
    const diskUsage = (data.diskUsed/data.diskTotal*100).toFixed(1);
    const networkRx = (data.network.rx_sec/1024).toFixed(1);
    const networkTx = (data.network.tx_sec/1024).toFixed(1);

    if(!ramChart){
      ramChart = new Chart(document.getElementById('ramChart'), {type:'doughnut', data:{labels:['Used','Free'],datasets:[{data:[ramUsage,100-ramUsage],backgroundColor:['#2196f3','#4caf50']}] }});
    } else { ramChart.data.datasets[0].data=[ramUsage,100-ramUsage]; ramChart.update(); }

    if(!diskChart){
      diskChart = new Chart(document.getElementById('diskChart'), {type:'doughnut', data:{labels:['Used','Free'],datasets:[{data:[diskUsage,100-diskUsage],backgroundColor:['#ff9800','#4caf50']}] }});
    } else { diskChart.data.datasets[0].data=[diskUsage,100-diskUsage]; diskChart.update(); }

    if(!networkChart){
      networkChart = new Chart(document.getElementById('networkChart'), {type:'line', data:{labels:['RX','TX'],datasets:[{label:'KB/s',data:[networkRx,networkTx],backgroundColor:['#2196f3','#ff9800']}] }});
    } else { networkChart.data.datasets[0].data=[networkRx,networkTx]; networkChart.update(); }

  }catch(e){ console.error('fetchStats error:', e);}
}

async function fetchServices(){
  try{
    const res = await fetch('/api/services?t='+Date.now());
    if(!res.ok) throw new Error('Services API error');
    const services = await res.json();
    const tbody = document.getElementById('servicesTable');
    tbody.innerHTML='';
    services.forEach(s=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${s.proto}</td><td>${s.localAddress}</td><td>${s.state}</td><td>${s.pid_program}</td>`;
      tbody.appendChild(tr);
    });
  }catch(e){console.error('fetchServices error:', e);}
}

async function restartServer(){
  try{
    const res=await fetch('/api/restart',{method:'POST'});
    const data=await res.json();
    alert(data.message);
  }catch(e){alert('Failed to restart server');}
}

function openLogin(){ window.open('/login','Login','width=400,height=500'); }

setInterval(fetchStats,2000);
setInterval(fetchServices,5000);
fetchStats();
fetchServices();
</script>

</body>
</html>
